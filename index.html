<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIM Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0078d4;
            --primary-dark: #005a9e;
            --secondary: #40e0d0;
            --accent: #ff6b6b;
            --bg-dark: #1e1e1e;
            --bg-darker: #141414;
            --text-light: #ffffff;
            --text-muted: #a0a0a0;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveGrid 20s linear infinite;
        }

        @keyframes moveGrid {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 50%;
            backdrop-filter: blur(5px);
            animation: float 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            right: 20%;
            animation-delay: 5s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            left: 70%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-100px) rotate(120deg); }
            66% { transform: translateY(100px) rotate(240deg); }
        }

        .container {
            display: flex;
            height: 100vh;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 0 80px rgba(0, 0, 0, 0.3);
        }

        /* Enhanced Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(180deg, var(--primary) 0%, transparent 100%);
            opacity: 0.1;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 20px;
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.3);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: rotate(360deg) scale(1.1);
        }

        .brand-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-light);
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .brand-name {
            opacity: 0;
            pointer-events: none;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section-title {
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-muted);
            letter-spacing: 1px;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .nav-section-title {
            opacity: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            margin: 5px 10px;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
            z-index: -1;
        }

        .nav-item:hover::before {
            width: 100%;
        }

        .nav-item:hover {
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.3);
        }

        .nav-icon {
            width: 21px;
            height: 21px;
            margin-right: 5px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.2);
        }

        .nav-text {
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .nav-text {
            opacity: 0;
            pointer-events: none;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            position: relative;
        }

        /* Control Bar - New Addition */
        .control-bar {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 200;
            align-items: center;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 12px;
            background: white;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.3);
        }

        .coffee-btn {
            background: linear-gradient(135deg, #ff9f00, #ff5722);
            color: white;
            padding: 0 15px;
            width: auto;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coffee-btn:hover {
            background: linear-gradient(135deg, #ff5722, #ff9f00);
            transform: translateY(-2px) scale(1.05);
        }

        /* Enhanced Top Bar with collapse animation */
        .top-bar {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 100;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .top-bar.collapsed {
            height: 0;
            padding: 0 20px;
            border-bottom: none;
        }

        .nav-controls {
            display: flex;
            gap: 5px;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            background: #f0f0f0;
            color: var(--primary);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .url-container {
            flex: 1;
            position: relative;
        }

        .url-bar {
            width: 100%;
            height: 40px;
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 0 45px 0 20px;
            font-size: 14px;
            background: #f5f5f5;
            transition: all 0.3s ease;
            outline: none;
        }

        .url-bar:focus {
            background: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 120, 212, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }

        /* Tab Bar */
        .tab-bar {
            background: white;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            overflow-x: auto;
        }

        .tab {
            min-width: 200px;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .tab:hover:not(.active) {
            background: #e0e0e0;
        }

        .tab-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .tab-title {
            flex: 1;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-close {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .tab-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .new-tab-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: transparent;
            color: #999;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .new-tab-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: white;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .welcome-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
            text-align: center;
            max-width: 600px;
        }

        .quick-access {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            max-width: 800px;
            width: 100%;
        }

        .quick-tile {
            background: white;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quick-tile::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .quick-tile:hover::before {
            animation: shine 0.6s ease;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .quick-tile:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 120, 212, 0.2);
        }

        .quick-tile-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            transition: transform 0.3s ease;
        }

        .quick-tile:hover .quick-tile-icon {
            transform: rotate(360deg);
        }

        .quick-tile-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .quick-tile-desc {
            font-size: 12px;
            color: #999;
        }

        /* User Info Section */
        .user-section {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 18px;
        }

        .user-info {
            flex: 1;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .user-info {
            opacity: 0;
            pointer-events: none;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-light);
            font-size: 14px;
        }

        .user-email {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Loading Indicator */
        .loading-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: loading 1.5s linear infinite;
            display: none;
        }

        @keyframes loading {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .loading-bar.active {
            display: block;
        }

        /* Toggle Button */
        .toggle-btn {
            position: absolute;
            right: -0.1px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .toggle-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-50%) scale(1.1);
        }

        .sidebar.collapsed .toggle-btn {
            transform: translateY(-50%) rotate(180deg);
        }

        /* Iframe styling */
        .content-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.4s ease;
        }

        @keyframes modalFadeIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .area-selection {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .area-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }

        .area-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .area-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .area-btn.selected:hover {
            color: white;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .pin-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .pin-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.2);
            outline: none;
        }

        .pin-input.error {
            border-color: #f44336;
            background: #ffebee;
            animation: shake 0.5s ease;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.3);
        }

        .login-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 120, 212, 0.4);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            color: #f44336;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            min-height: 20px;
            font-weight: 500;
        }

        .login-success {
            color: #4CAF50;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 500;
        }

        .area-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .area-info.selected {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.1), rgba(64, 224, 208, 0.1));
            border-color: var(--primary);
        }

        .area-info h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 16px;
        }

        .area-info p {
            color: #666;
            font-size: 12px;
            margin: 0;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Notification Styles */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 1000;
                height: 100vh;
            }

            .sidebar.active {
                left: 0;
            }

            .toggle-btn {
                display: none;
            }

            .quick-access {
                grid-template-columns: repeat(2, 1fr);
            }

            .welcome-title {
                font-size: 36px;
            }

            .area-selection {
                flex-direction: column;
                gap: 8px;
            }

            .area-btn {
                width: 100%;
            }

            .control-bar {
                right: 10px;
                top: 5px;
            }

            .control-btn {
                width: 35px;
                height: 35px;
            }

            .coffee-btn {
                padding: 0 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <h2 class="login-title">Akses Area Regional</h2>
                <p class="login-subtitle">Pilih area dan masukkan PIN untuk mengakses dashboard</p>
            </div>
            
            <div class="area-info" id="areaInfo">
                <h4>Pilih Area Regional</h4>
                <p>Silakan pilih area yang ingin diakses</p>
            </div>

            <div class="area-selection">
                <button class="area-btn" onclick="selectArea('BALI', this)">BALI</button>
                <button class="area-btn" onclick="selectArea('NTB', this)">NTB</button>
                <button class="area-btn" onclick="selectArea('NTT', this)">NTT</button>
            </div>
            
            <div class="pin-input-container">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this)" onkeydown="handlePinInput(event)" disabled>
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this)" onkeydown="handlePinInput(event)" disabled>
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this)" onkeydown="handlePinInput(event)" disabled>
            </div>
            
            <button class="login-btn" onclick="validatePin()" disabled id="loginBtn">Pilih Area Terlebih Dahulu</button>
            
            <div class="login-error" id="loginError"></div>
            <div class="login-success" id="loginSuccess"></div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="toggle-btn" onclick="toggleSidebar()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>

            <div class="sidebar-header">
                <div class="logo">PT</div>
                <span class="brand-name">Cahya Intan Medika</span>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-item active" onclick="showWelcome(this)">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        <span class="nav-text">Home</span>
                    </div>
                </div>

                <!-- Area sections will be dynamically shown after login -->
                <div id="areaSections" style="display: none;">
                    <!-- Area sections will be inserted here by JavaScript -->
                </div>
            </nav>

            <div class="user-section">
                <div class="user-avatar" id="userAvatar">‚ù§Ô∏è‚Äçüî•</div>
                <div class="user-info">
                    <div class="user-name" id="userName">CIM User</div>
                    <div class="user-email" id="userEmail">Ready to browse</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="loading-bar" id="loadingBar"></div>
            
            <!-- Control Bar - New Addition -->
            <div class="control-bar">
                <button class="control-btn" onclick="toggleTopBar()" title="Toggle Navigation Bar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" id="toggleIcon">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </button>
                <button class="coffee-btn control-btn" onclick="openBuyMeCoffee()" title="Support Us">
                    ‚òï Buy Me Coffee
                </button>
            </div>
            
            <!-- Top Bar -->
            <div class="top-bar" id="topBar">
                <div class="nav-controls">
                    <button class="nav-btn" onclick="goBack()" title="Back">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                        </svg>
                    </button>
                    <button class="nav-btn" onclick="goForward()" title="Forward">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                        </svg>
                    </button>
                    <button class="nav-btn" onclick="refreshPage()" title="Refresh">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                        </svg>
                    </button>
                </div>

                <div class="url-container">
                    <input type="text" class="url-bar" id="urlBar" placeholder="Search or enter web address">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </div>
            </div>

            <!-- Tab Bar -->
            <div class="tab-bar" id="tabBar">
                <div class="tab active" data-tab-id="0" onclick="switchTab(this)">
                    <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span class="tab-title">New Tab</span>
                    <button class="tab-close" onclick="closeTab(event, this)">√ó</button>
                </div>
                <button class="new-tab-btn" onclick="addNewTab()">+</button>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <div class="welcome-screen" id="welcomeScreen-0" style="display: flex;">
                    <h1 class="welcome-title">üíó ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê üíó</h1>
                    <p class="welcome-subtitle">Awali segala aktifitasmu dengan mengucapkan bismillah</p>
                    
                    <div class="quick-access">
                        <div class="quick-tile" onclick="showLogin()">
                            <div class="quick-tile-icon">üîê</div>
                            <div class="quick-tile-title">Login Area</div>
                            <div class="quick-tile-desc">Akses Dashboard Regional</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
       // ===== STATE MANAGEMENT =====
let tabs = [];
let activeTabId = 0;
let nextTabId = 1;
let currentArea = null;
let selectedArea = null;
let topBarCollapsed = false;

// ===== ENCRYPTED PIN DATA =====
let encryptedAreaPins = {
    'BALI': 'OTkx',     
    'NTB': 'MzMx',      
    'NTT': 'NjYx'       
};

// ===== SECURITY SYSTEM =====
let loginAttempts = {};
const MAX_ATTEMPTS = 5;
const LOCKOUT_TIME = 300000; // 5 menit
const SESSION_TIMEOUT = 1800000; // 30 menit
let sessionStartTime = null;
let sessionChecker = null;

// ===== NEW FUNCTIONS FOR TOGGLE AND COFFEE =====
function toggleTopBar() {
    const topBar = document.getElementById('topBar');
    const toggleIcon = document.getElementById('toggleIcon');
    
    topBarCollapsed = !topBarCollapsed;
    
    if (topBarCollapsed) {
        topBar.classList.add('collapsed');
        toggleIcon.innerHTML = '<path d="M7 14l5-5 5 5z"/>';
    } else {
        topBar.classList.remove('collapsed');
        toggleIcon.innerHTML = '<path d="M7 10l5 5 5-5z"/>';
    }
}

function openBuyMeCoffee() {
    // Tampilkan konfirmasi sebelum membuka link eksternal
    const confirmOpen = confirm('Anda akan membuka halaman donasi di tab browser baru.\n\nLanjutkan?');
    
    if (confirmOpen) {
        // Pilih salah satu platform donasi yang Anda gunakan:
        
        // Option 1: Buy Me a Coffee
        const coffeeUrl = 'https://www.buymeacoffee.com/yourusername';
        
        // Option 2: Ko-fi (alternatif)
        // const coffeeUrl = 'https://ko-fi.com/yourusername';
        
        // Option 3: PayPal Donation
        // const coffeeUrl = 'https://www.paypal.com/donate/?hosted_button_id=YOUR_BUTTON_ID';
        
        // Option 4: Saweria (untuk Indonesia)
        // const coffeeUrl = 'https://saweria.co/yourusername';
        
        // Option 5: Trakteer (untuk Indonesia)
        // const coffeeUrl = 'https://trakteer.id/yourusername';
        
        // Buka di tab browser eksternal (bukan dalam iframe)
        const newWindow = window.open(coffeeUrl, '_blank');
        
        // Cek apakah popup blocker aktif
        if (newWindow) {
            showNotification('Opening donation page in new browser tab...', 'success');
        } else {
            showNotification('Please allow popups to open donation page', 'warning');
            // Alternatif: copy link to clipboard
            navigator.clipboard.writeText(coffeeUrl).then(() => {
                showNotification('Link copied to clipboard! You can paste it in your browser.', 'info');
            });
        }
    }
}

// ===== RATE LIMITING FUNCTIONS =====
function checkRateLimit(area) {
    const now = Date.now();
    
    if (!loginAttempts[area]) {
        loginAttempts[area] = { count: 0, lastAttempt: now };
        return true;
    }
    
    const attempts = loginAttempts[area];
    
    // Reset counter jika sudah lewat lockout time
    if (now - attempts.lastAttempt > LOCKOUT_TIME) {
        attempts.count = 0;
        attempts.lastAttempt = now;
        return true;
    }
    
    // Cek apakah masih dalam masa lockout
    if (attempts.count >= MAX_ATTEMPTS) {
        const remainingTime = Math.ceil((LOCKOUT_TIME - (now - attempts.lastAttempt)) / 1000);
        if (remainingTime > 0) {
            showLoginError(`Terlalu banyak percobaan. Coba lagi dalam ${remainingTime} detik.`);
            return false;
        }
    }
    
    return true;
}

function recordFailedAttempt(area) {
    const now = Date.now();
    
    if (!loginAttempts[area]) {
        loginAttempts[area] = { count: 0, lastAttempt: now };
    }
    
    loginAttempts[area].count++;
    loginAttempts[area].lastAttempt = now;
    
    console.warn(`Failed login attempt for ${area}. Count: ${loginAttempts[area].count}`);
}

function resetLoginAttempts(area) {
    if (loginAttempts[area]) {
        loginAttempts[area].count = 0;
    }
}

// ===== SESSION MANAGEMENT =====
function startSession() {
    sessionStartTime = Date.now();
    
    if (sessionChecker) {
        clearInterval(sessionChecker);
    }
    
    sessionChecker = setInterval(() => {
        if (currentArea && !checkSessionTimeout()) {
            clearInterval(sessionChecker);
            sessionChecker = null;
        }
    }, 60000);
    
    console.info('Session started with 30-minute timeout');
}

function checkSessionTimeout() {
    if (!sessionStartTime || !currentArea) {
        return true;
    }
    
    const sessionDuration = Date.now() - sessionStartTime;
    
    if (sessionDuration > SESSION_TIMEOUT) {
        console.warn('Session timeout detected');
        logout();
        showNotification('Session expired. Please login again.', 'error');
        return false;
    }
    
    return true;
}

function endSession() {
    sessionStartTime = null;
    
    if (sessionChecker) {
        clearInterval(sessionChecker);
        sessionChecker = null;
    }
    
    console.info('Session ended');
}

// ===== AREA DATA =====
let areaData = {
    'BALI': {
        title: 'BALI',
        items: [
            { name: 'Data Center Bali', url: 'https://script.google.com/macros/s/AKfycbx0-cB4AiSSLRf2T4nbcngraPQQ0Vrx80lMMK_25H8ybd6VJdKHxFk7KWPm7J5mcXYP/exec', icon: 'sales' },
            { name: 'Penawaran Bali', url: 'https://script.google.com/macros/s/AKfycbxA10mgJgUypSHNewiyuo89R24DYOtfwk31-POFP5d1uqLHknBiPBeRuV06wJIXi7tCvw/exec', icon: 'reports' },
            { name: 'Finance Bali', url: 'https://script.google.com/macros/s/AKfycbyQGfbe-SrYRLVaRdZ02aiz-Vk4MeAXhQaCjKkL3EP9crwPj4qnCL4GzIk1RRD4eHSuwA/exec', icon: 'analytics' },
            { name: 'Faktur Bali', url: 'https://script.google.com/macros/s/AKfycbxtUQS9z2X0AJ4RCGJjPGc9_2O2hEov_U7gU9KwHUanO2TGjUMsMwa5xDuAS5sJT9zZ/exec', icon: 'analytics' }
        ]
    },
    'NTB': {
        title: 'NTB',
        items: [
            { name: 'Penawaran NTB', url: 'https://script.google.com/macros/s/AKfycbxA10mgJgUypSHNewiyuo89R24DYOtfwk31-POFP5d1uqLHknBiPBeRuV06wJIXi7tCvw/exec', icon: 'reports' },
            { name: 'Faktur NTB', url: 'https://script.google.com/macros/s/AKfycbzveJ5m56TlE_5NAYP-m5ek9QoD3zgVJ2kem_BAvO1qYrkGztQDp0nT4qFF-yfw-XZeiA/exec', icon: 'analytics' }
        ]
    },
    'NTT': {
        title: 'NTT',
        items: [
            { name: 'Penawaran NTT', url: 'https://script.google.com/macros/s/AKfycbxA10mgJgUypSHNewiyuo89R24DYOtfwk31-POFP5d1uqLHknBiPBeRuV06wJIXi7tCvw/exec', icon: 'reports' },
            { name: 'Faktur NTT', url: '#', icon: 'analytics' }
        ]
    }
};

// ===== INITIALIZATION =====
// Initialize first tab
tabs.push({
    id: 0,
    url: '',
    title: 'New Tab',
    isHomePage: true,
    history: [],
    historyIndex: -1
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.info('Edge Browser initialized');
    setupKeyboardShortcuts();
    
    // Check if user was previously logged in - FIXED: gunakan encryptedAreaPins
    const savedArea = sessionStorage.getItem('currentArea');
    if (savedArea && encryptedAreaPins[savedArea]) {
        console.info(`Restoring session for area: ${savedArea}`);
        currentArea = savedArea;
        showAreaSection(currentArea);
        startSession(); // Restart session
    } else {
        // Ensure Home is visible when not logged in
        const homeNavItem = document.querySelector('.nav-item[onclick*="showWelcome"]');
        if (homeNavItem) {
            homeNavItem.style.display = 'flex';
        }
    }
});

// ===== LOGIN FUNCTIONALITY =====
function showLogin() {
    document.getElementById('loginModal').style.display = 'flex';
    resetLoginForm();
}

function resetLoginForm() {
    selectedArea = null;
    document.getElementById('loginError').textContent = '';
    document.getElementById('loginSuccess').textContent = '';
    
    // Reset area selection
    document.querySelectorAll('.area-btn').forEach(btn => btn.classList.remove('selected'));
    
    // Reset area info
    const areaInfo = document.getElementById('areaInfo');
    areaInfo.classList.remove('selected');
    areaInfo.innerHTML = '<h4>Pilih Area Regional</h4><p>Silakan pilih area yang ingin diakses</p>';
    
    // Clear and disable PIN inputs
    const pinInputs = document.querySelectorAll('.pin-input');
    pinInputs.forEach(input => {
        input.value = '';
        input.disabled = true;
        input.classList.remove('error');
    });
    
    // Disable login button
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.disabled = true;
    loginBtn.textContent = 'Pilih Area Terlebih Dahulu';
}

function selectArea(area, button) {
    selectedArea = area;
    console.info(`Area selected: ${area}`);
    
    // Update button states
    document.querySelectorAll('.area-btn').forEach(btn => btn.classList.remove('selected'));
    button.classList.add('selected');
    
    // Update area info
    const areaInfo = document.getElementById('areaInfo');
    areaInfo.classList.add('selected');
    areaInfo.innerHTML = `
        <h4>Area ${area}</h4>
        <p>Masukkan PIN 3 digit untuk area ${area}</p>
    `;
    
    // Enable PIN inputs
    const pinInputs = document.querySelectorAll('.pin-input');
    pinInputs.forEach(input => {
        input.disabled = false;
        input.classList.remove('error');
        input.value = '';
    });
    pinInputs[0].focus();
    
    // Enable login button
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.disabled = false;
    loginBtn.textContent = `Login ke Area ${area}`;
    
    // Clear messages
    document.getElementById('loginError').textContent = '';
    document.getElementById('loginSuccess').textContent = '';
}

function moveToNext(input) {
    if (input.value.length === 1) {
        const next = input.nextElementSibling;
        if (next && next.classList.contains('pin-input')) {
            next.focus();
        }
        
        // Auto-submit if all inputs are filled
        const pinInputs = document.querySelectorAll('.pin-input');
        const allFilled = Array.from(pinInputs).every(inp => inp.value.length === 1);
        if (allFilled) {
            setTimeout(() => validatePin(), 300);
        }
    }
}

function handlePinInput(event) {
    const input = event.target;
    
    if (event.key === 'Backspace') {
        if (input.value === '') {
            const prev = input.previousElementSibling;
            if (prev && prev.classList.contains('pin-input')) {
                prev.focus();
            }
        }
    }
    
    // Only allow numbers
    if (event.key && !/[0-9]/.test(event.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(event.key)) {
        event.preventDefault();
    }
}

// ===== PIN VALIDATION - FIXED =====
function validatePin() {
    console.info('validatePin() called');
    
    // Cek apakah area sudah dipilih
    if (!selectedArea) {
        showLoginError('Pilih area terlebih dahulu');
        return;
    }

    // Cek rate limiting untuk mencegah brute force
    if (!checkRateLimit(selectedArea)) {
        return;
    }

    // Ambil PIN yang diinput user
    const pinInputs = document.querySelectorAll('.pin-input');
    const enteredPin = Array.from(pinInputs).map(input => input.value).join('');
    
    console.info(`Entered PIN: ${enteredPin}, Selected Area: ${selectedArea}`);
    
    // Validasi panjang PIN
    if (enteredPin.length !== 3) {
        showLoginError('PIN harus 3 digit');
        return;
    }
    
    // Validasi format PIN (harus angka)
    if (!/^\d{3}$/.test(enteredPin)) {
        showLoginError('PIN harus berupa angka');
        return;
    }
    
    console.info(`Validating PIN for area: ${selectedArea}`);
    console.info(`Encoded input: ${btoa(enteredPin)}, Stored: ${encryptedAreaPins[selectedArea]}`);
    
    // VALIDASI DENGAN BASE64 ENCRYPTION
    if (btoa(enteredPin) === encryptedAreaPins[selectedArea]) {
        console.info('‚úÖ PIN validation successful');
        
        // Reset attempts counter
        resetLoginAttempts(selectedArea);
        
        // Mulai session
        startSession();
        
        // Tampilkan sukses
        showLoginSuccess(`Berhasil login ke Area ${selectedArea}`);
        
        // Proses login
        setTimeout(() => {
            document.getElementById('loginModal').style.display = 'none';
            sessionStorage.setItem('currentArea', selectedArea);
            currentArea = selectedArea;
            clearAllTabs();
            showAreaSection(selectedArea);
            showWelcome(null);
            showNotification(`Selamat datang di Area ${selectedArea}`, 'success');
        }, 1500);
        
    } else {
        console.warn('‚ùå PIN validation failed');
        
        // Catat percobaan gagal
        recordFailedAttempt(selectedArea);
        
        // Tampilkan error
        showLoginError(`PIN salah untuk Area ${selectedArea}. Silakan coba lagi.`);
        
        // Efek visual error
        const pinInputs = document.querySelectorAll('.pin-input');
        pinInputs.forEach(input => {
            input.classList.add('error');
            input.value = '';
        });
        
        // Hapus efek error setelah 1 detik
        setTimeout(() => {
            pinInputs.forEach(input => input.classList.remove('error'));
            if (pinInputs[0]) {
                pinInputs[0].focus();
            }
        }, 1000);
    }
}

function showLoginError(message) {
    document.getElementById('loginError').textContent = message;
    document.getElementById('loginSuccess').textContent = '';
}

function showLoginSuccess(message) {
    document.getElementById('loginSuccess').textContent = message;
    document.getElementById('loginError').textContent = '';
}

// ===== AREA SECTION MANAGEMENT =====
function showAreaSection(area) {
    const areaSections = document.getElementById('areaSections');
    areaSections.style.display = 'block';
    
    // Hide Home menu item when logged in
    const homeNavItem = document.querySelector('.nav-item[onclick*="showWelcome"]');
    if (homeNavItem) {
        homeNavItem.style.display = 'none';
    }
    
    // Clear previous area sections
    areaSections.innerHTML = '';
    
    // Create logout button first
    const logoutSection = document.createElement('div');
    logoutSection.className = 'nav-section';
    logoutSection.innerHTML = `
        <div class="nav-item" onclick="logout()" style="color: #f44336;">
            <svg class="nav-icon" viewBox="0 -960 960 960" fill="currentColor">
                <path d="M240-640h360v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85h-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640Zm0 480h480v-400H240v400Zm240-120q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM240-160v-400 400Z"/>
            </svg>
            <span class="nav-text">Logout</span>
        </div>
    `;
    
    // Create new area section
    const section = document.createElement('div');
    section.className = 'nav-section';
    
    // Add title
    const title = document.createElement('div');
    title.className = 'nav-section-title';
    title.textContent = `AREA ${area}`;
    section.appendChild(title);
    
    // Add menu items
    areaData[area].items.forEach(item => {
        const navItem = document.createElement('div');
        navItem.className = 'nav-item';
        navItem.onclick = function() { 
            addNewTab(item.url, item.name, this);
        };
        
        // Add icon based on item type
        let iconPath = '';
        switch(item.icon) {
            case 'analytics':
                iconPath = '<path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>';
                break;
            case 'sales':
                iconPath = '<path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>';
                break;
            case 'reports':
                iconPath = '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>';
                break;
        }
        
        navItem.innerHTML = `
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                ${iconPath}
            </svg>
            <span class="nav-text">${item.name}</span>
        `;
        
        section.appendChild(navItem);
    });
    
    areaSections.appendChild(section);
    areaSections.appendChild(logoutSection);
    
    // Update user info
    document.getElementById('userName').textContent = `Area ${area}`;
    document.getElementById('userEmail').textContent = 'Logged In';
    document.getElementById('userAvatar').textContent = area.charAt(0);
    
    console.info(`Area section shown for: ${area}`);
}

function logout() {
    console.info('Logging out...');
    
    // Clear session
    sessionStorage.removeItem('currentArea');
    currentArea = null;
    selectedArea = null;
    
    // End session
    endSession();
    
    // Clear login attempts
    loginAttempts = {};
    
    // Hide area sections
    document.getElementById('areaSections').style.display = 'none';
    
    // Show Home menu item again
    const homeNavItem = document.querySelector('.nav-item[onclick*="showWelcome"]');
    if (homeNavItem) {
        homeNavItem.style.display = 'flex';
        setActiveNavItem(homeNavItem);
    }
    
    // Clear all tabs and create new default tab
    clearAllTabs();
    
    // Reset user info
    document.getElementById('userName').textContent = 'User';
    document.getElementById('userEmail').textContent = 'Ready to login';
    document.getElementById('userAvatar').textContent = 'üêª';
    
    // Go back to welcome screen
    showWelcome(homeNavItem);
    
    showNotification('Berhasil logout', 'info');
}

// Helper function to clear all tabs
function clearAllTabs() {
    const tabBar = document.getElementById('tabBar');
    const contentArea = document.querySelector('.content-area');
    
    // Remove all existing tabs
    const existingTabs = tabBar.querySelectorAll('.tab');
    existingTabs.forEach(tab => tab.remove());
    
    // Remove all existing content
    const existingContent = contentArea.querySelectorAll('.welcome-screen, .content-iframe');
    existingContent.forEach(content => content.remove());
    
    // Reset tab system
    tabs = [];
    activeTabId = 0;
    nextTabId = 1;
    
    // Create new default tab
    tabs.push({
        id: 0,
        url: '',
        title: 'New Tab',
        isHomePage: true,
        history: [],
        historyIndex: -1
    });
    
    const newTabBtn = tabBar.querySelector('.new-tab-btn');
    const defaultTab = document.createElement('div');
    defaultTab.className = 'tab active';
    defaultTab.setAttribute('data-tab-id', '0');
    defaultTab.innerHTML = `
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span class="tab-title">New Tab</span>
        <button class="tab-close" onclick="closeTab(event, this)">√ó</button>
    `;
    defaultTab.onclick = function() { switchTab(this); };
    
    tabBar.insertBefore(defaultTab, newTabBtn);
    
    // Create welcome screen for default tab
    const welcomeScreen = document.createElement('div');
    welcomeScreen.className = 'welcome-screen';
    welcomeScreen.id = 'welcomeScreen-0';
    welcomeScreen.style.display = 'flex';
    welcomeScreen.innerHTML = `
        <h1 class="welcome-title">Welcome to Edge Pro</h1>
        <p class="welcome-subtitle">Experience the next generation of web browsing with advanced features and stunning design</p>
        
        <div class="quick-access">
            <div class="quick-tile" onclick="showLogin()">
                <div class="quick-tile-icon">üîê</div>
                <div class="quick-tile-title">Login Area</div>
                <div class="quick-tile-desc">Akses Dashboard Regional</div>
            </div>
        </div>
    `;
    
    contentArea.appendChild(welcomeScreen);
}

// Sidebar toggle
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
}

// Tab management dengan sistem terpisah
function addNewTab(url = '', title = 'New Tab', navItem = null) {
    const tabBar = document.getElementById('tabBar');
    const contentArea = document.querySelector('.content-area');
    const newTabBtn = tabBar.querySelector('.new-tab-btn');
    
    const tabId = nextTabId++;
    
    // Add to tabs array
    tabs.push({
        id: tabId,
        url: url,
        title: title,
        isHomePage: !url,
        history: url ? [{ url, title, timestamp: Date.now() }] : [],
        historyIndex: url ? 0 : -1
    });
    
    // Create new tab element
    const tab = document.createElement('div');
    tab.className = 'tab';
    tab.setAttribute('data-tab-id', tabId);
    tab.innerHTML = `
        <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <span class="tab-title">${title}</span>
        <button class="tab-close" onclick="closeTab(event, this)">√ó</button>
    `;
    tab.onclick = function() { switchTab(this); };
    
    tabBar.insertBefore(tab, newTabBtn);
    
    // Create content for this tab
    if (url) {
        // Create iframe for URL
        const iframe = document.createElement('iframe');
        iframe.className = 'content-iframe';
        iframe.id = `iframe-${tabId}`;
        iframe.style.display = 'none';
        iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');
        iframe.src = url;
        contentArea.appendChild(iframe);
    } else {
        // Create welcome screen for empty tab
        const welcomeScreen = document.createElement('div');
        welcomeScreen.className = 'welcome-screen';
        welcomeScreen.id = `welcomeScreen-${tabId}`;
        welcomeScreen.style.display = 'none';
        welcomeScreen.innerHTML = `
            <h1 class="welcome-title">Welcome to Edge Pro</h1>
            <p class="welcome-subtitle">Experience the next generation of web browsing with advanced features and stunning design</p>
            
            <div class="quick-access">
                <div class="quick-tile" onclick="showLogin()">
                    <div class="quick-tile-icon">üîê</div>
                    <div class="quick-tile-title">Login Area</div>
                    <div class="quick-tile-desc">Akses Dashboard Regional</div>
                </div>
            </div>
        `;
        contentArea.appendChild(welcomeScreen);
    }
    
    // Switch to new tab
    switchTab(tab);
    
    // Update nav item
    if (navItem) {
        setActiveNavItem(navItem);
    }
    
    // Update URL bar
    updateUrlBar();
}

function switchTab(tabElement) {
    const tabId = parseInt(tabElement.getAttribute('data-tab-id'));
    
    // Update active tab
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tabElement.classList.add('active');
    activeTabId = tabId;
    
    // Hide all content
    document.querySelectorAll('.content-iframe, .welcome-screen').forEach(content => {
        content.style.display = 'none';
    });
    
    // Show content for active tab
    const tab = tabs.find(t => t.id === tabId);
    if (tab.isHomePage) {
        const welcomeScreen = document.getElementById(`welcomeScreen-${tabId}`);
        if (welcomeScreen) {
            welcomeScreen.style.display = 'flex';
        }
    } else {
        const iframe = document.getElementById(`iframe-${tabId}`);
        if (iframe) {
            iframe.style.display = 'block';
        }
    }
    
    updateUrlBar();
    updateNavigationButtons();
}

function closeTab(event, button) {
    event.stopPropagation();
    const tab = button.parentElement;
    const tabId = parseInt(tab.getAttribute('data-tab-id'));
    const tabBar = document.getElementById('tabBar');
    
    if (tabBar.querySelectorAll('.tab').length > 1) {
        // Remove from tabs array
        tabs = tabs.filter(t => t.id !== tabId);
        
        // Remove content
        const iframe = document.getElementById(`iframe-${tabId}`);
        const welcomeScreen = document.getElementById(`welcomeScreen-${tabId}`);
        if (iframe) iframe.remove();
        if (welcomeScreen) welcomeScreen.remove();
        
        // Remove tab element
        tab.remove();
        
        // If this was the active tab, activate another tab
        if (tab.classList.contains('active')) {
            const firstTab = tabBar.querySelector('.tab');
            if (firstTab) {
                switchTab(firstTab);
            }
        }
    }
}

// Navigation dengan history per tab
function navigateTo(url, hideUrl = false, displayName = '') {
    const tab = tabs.find(t => t.id === activeTabId);
    if (!tab) return;
    
    const loadingBar = document.getElementById('loadingBar');
    
    // Update tab data
    tab.url = url;
    tab.title = displayName || url;
    tab.isHomePage = false;
    
    // Add to tab history
    addToTabHistory(activeTabId, url, displayName || url);
    
    // Hide welcome screen if exists
    const welcomeScreen = document.getElementById(`welcomeScreen-${activeTabId}`);
    if (welcomeScreen) {
        welcomeScreen.style.display = 'none';
    }
    
    // Get or create iframe for this tab
    let iframe = document.getElementById(`iframe-${activeTabId}`);
    if (!iframe) {
        iframe = document.createElement('iframe');
        iframe.className = 'content-iframe';
        iframe.id = `iframe-${activeTabId}`;
        iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');
        document.querySelector('.content-area').appendChild(iframe);
    }
    
    iframe.style.display = 'block';
    
    loadingBar.classList.add('active');
    
    // Load the URL in iframe
    try {
        iframe.src = url;
        
        // Update tab title
        const tabElement = document.querySelector(`[data-tab-id="${activeTabId}"]`);
        if (tabElement) {
            const titleElement = tabElement.querySelector('.tab-title');
            titleElement.textContent = displayName || 'Loading...';
        }
        
        // Hide loading bar after iframe loads
        iframe.onload = function() {
            loadingBar.classList.remove('active');
        };
        
        // Handle load error
        iframe.onerror = function() {
            loadingBar.classList.remove('active');
            showNotification('Failed to load page', 'error');
        };
        
        // Timeout fallback
        setTimeout(() => {
            loadingBar.classList.remove('active');
        }, 5000);
        
    } catch (error) {
        loadingBar.classList.remove('active');
        showNotification('Error loading page', 'error');
    }
    
    updateUrlBar();
}

function showWelcome(navItem) {
    const tab = tabs.find(t => t.id === activeTabId);
    if (!tab) return;
    
    // Hide iframe for this tab
    const iframe = document.getElementById(`iframe-${activeTabId}`);
    if (iframe) {
        iframe.style.display = 'none';
    }
    
    // Show welcome screen for this tab
    const welcomeScreen = document.getElementById(`welcomeScreen-${activeTabId}`);
    if (welcomeScreen) {
        welcomeScreen.style.display = 'flex';
    }
    
    // Update tab data
    tab.isHomePage = true;
    tab.url = '';
    
    updateUrlBar();
    
    if (navItem) {
        setActiveNavItem(navItem);
    }
}

function setActiveNavItem(item) {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
}

// History management per tab
function addToTabHistory(tabId, url, title) {
    const tab = tabs.find(t => t.id === tabId);
    if (!tab) return;
    
    const historyItem = { url, title, timestamp: Date.now() };
    
    // Remove any items after current index (for new navigation after going back)
    tab.history = tab.history.slice(0, tab.historyIndex + 1);
    
    // Add new item
    tab.history.push(historyItem);
    tab.historyIndex = tab.history.length - 1;
    
    // Limit history size
    if (tab.history.length > 50) {
        tab.history.shift();
        tab.historyIndex--;
    }
    
    updateNavigationButtons();
}

function updateNavigationButtons() {
    const tab = tabs.find(t => t.id === activeTabId);
    const backBtn = document.querySelector('.nav-btn[onclick="goBack()"]');
    const forwardBtn = document.querySelector('.nav-btn[onclick="goForward()"]');
    
    if (tab) {
        backBtn.disabled = tab.historyIndex <= 0;
        forwardBtn.disabled = tab.historyIndex >= tab.history.length - 1;
    } else {
        backBtn.disabled = true;
        forwardBtn.disabled = true;
    }
}

function updateUrlBar() {
    const tab = tabs.find(t => t.id === activeTabId);
    const urlBar = document.getElementById('urlBar');
    
    if (tab) {
        if (tab.isHomePage) {
            urlBar.value = '';
        } else if (tab.url && tab.url.includes('script.google.com')) {
            urlBar.value = tab.title || 'Dashboard Internal';
        } else {
            urlBar.value = tab.url || '';
        }
    }
}

// Browser controls per tab
function goBack() {
    const tab = tabs.find(t => t.id === activeTabId);
    if (!tab || tab.historyIndex <= 0) return;
    
    tab.historyIndex--;
    const historyItem = tab.history[tab.historyIndex];
    
    const iframe = document.getElementById(`iframe-${activeTabId}`);
    if (iframe) {
        iframe.src = historyItem.url;
        tab.url = historyItem.url;
        tab.title = historyItem.title;
        updateUrlBar();
    }
    
    updateNavigationButtons();
}

function goForward() {
    const tab = tabs.find(t => t.id === activeTabId);
    if (!tab || tab.historyIndex >= tab.history.length - 1) return;
    
    tab.historyIndex++;
    const historyItem = tab.history[tab.historyIndex];
    
    const iframe = document.getElementById(`iframe-${activeTabId}`);
    if (iframe) {
        iframe.src = historyItem.url;
        tab.url = historyItem.url;
        tab.title = historyItem.title;
        updateUrlBar();
    }
    
    updateNavigationButtons();
}

function refreshPage() {
    const tab = tabs.find(t => t.id === activeTabId);
    if (!tab || tab.isHomePage) return;
    
    const iframe = document.getElementById(`iframe-${activeTabId}`);
    if (iframe) {
        const currentSrc = iframe.src;
        iframe.src = '';
        setTimeout(() => {
            iframe.src = currentSrc;
            showNotification('Page refreshed', 'success');
        }, 100);
    }
}

// URL bar functionality
document.addEventListener('DOMContentLoaded', function() {
    const urlBar = document.getElementById('urlBar');
    
    if (urlBar) {
        urlBar.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const url = this.value.trim();
                if (url) {
                    let fullUrl = url;
                    
                    // Add protocol if missing
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        // Check if it looks like a URL
                        if (url.includes('.') && !url.includes(' ')) {
                            fullUrl = 'https://' + url;
                        } else {
                            // Treat as search query
                            fullUrl = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
                        }
                    }
                    
                    navigateTo(fullUrl, false, url);
                    this.blur();
                }
            }
        });

        // Focus URL bar on click
        urlBar.addEventListener('focus', function() {
            this.select();
        });
    }
});

// Notifications
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${
            type === 'success' ? '#4CAF50' : 
            type === 'error' ? '#f44336' : 
            type === 'warning' ? '#ff9800' :
            '#2196F3'
        };
        color: white;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        z-index: 10001;
        animation: slideIn 0.3s ease;
        max-width: 300px;
        font-size: 14px;
        font-weight: 500;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Keyboard shortcuts
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(e) {
        // Ctrl+T: New tab
        if (e.ctrlKey && e.key === 't') {
            e.preventDefault();
            addNewTab();
        }
        
        // Ctrl+W: Close tab
        if (e.ctrlKey && e.key === 'w') {
            e.preventDefault();
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const closeBtn = activeTab.querySelector('.tab-close');
                closeBtn.click();
            }
        }
        
        // F5: Refresh
        if (e.key === 'F5') {
            e.preventDefault();
            refreshPage();
        }
        
        // Ctrl+L: Focus URL bar
        if (e.ctrlKey && e.key === 'l') {
            e.preventDefault();
            const urlBar = document.getElementById('urlBar');
            if (urlBar) {
                urlBar.focus();
                urlBar.select();
            }
        }

        // Escape: Close login modal
        if (e.key === 'Escape') {
            const loginModal = document.getElementById('loginModal');
            if (loginModal && loginModal.style.display === 'flex') {
                loginModal.style.display = 'none';
            }
        }

        // Enter in PIN input: Submit
        if (e.key === 'Enter' && document.getElementById('loginModal') && document.getElementById('loginModal').style.display === 'flex') {
            validatePin();
        }

        // Alt+Left: Go back
        if (e.altKey && e.key === 'ArrowLeft') {
            e.preventDefault();
            goBack();
        }

        // Alt+Right: Go forward
        if (e.altKey && e.key === 'ArrowRight') {
            e.preventDefault();
            goForward();
        }

        // Ctrl+R: Refresh
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            refreshPage();
        }

        // Ctrl+Shift+I: Toggle sidebar
        if (e.ctrlKey && e.shiftKey && e.key === 'I') {
            e.preventDefault();
            toggleSidebar();
        }

        // Ctrl+H: Toggle Top Bar
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            toggleTopBar();
        }
    });
}

// Initialize navigation buttons state
updateNavigationButtons();

// Auto-save area selection
window.addEventListener('beforeunload', function() {
    if (currentArea) {
        sessionStorage.setItem('currentArea', currentArea);
    }
});

    </script>
</body>
</html>


